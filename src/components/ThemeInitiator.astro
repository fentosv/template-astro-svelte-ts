<script is:inline>
// Inline: not bundled, so will execute the first
// We need to load theme asap, so we are handling it in the layout.
const STORAGE_THEME_KEY = 'theme'
const DARK_THEME_CLASS = 'theme-dark'
const root = document.documentElement

const getLocalStorageTheme = (localStorageKey) => {
    if (localStorage && localStorage.getItem(localStorageKey))
        return localStorage.getItem(localStorageKey)
    if (window.matchMedia('(prefers-color-scheme: dark)').matches) return 'dark'
    return 'light'
}

const theme = getLocalStorageTheme(STORAGE_THEME_KEY)
let isDark = theme === 'dark'

root.classList.toggle(DARK_THEME_CLASS, isDark)

function handleClick() {
    isDark = !isDark

    root.classList.toggle(DARK_THEME_CLASS, isDark)
    localStorage.setItem(STORAGE_THEME_KEY, isDark ? 'dark' : 'light')
}

const button = document.getElementById('theme-toggle')
button?.addEventListener('click', () => handleClick())
</script>
